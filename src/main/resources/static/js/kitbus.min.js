(function(){this.App={}}).call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.defaults={departureTime:""},b}(Backbone.Model),App.RideBusModel=a,App.rideBusModel=new App.RideBusModel}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.model=App.TimetableModel,b}(Backbone.Collection),App.TimetableCollection=a,App.timetableList=new a}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.SHUTTLE_OUTWARD="OUTWARD",b.SHUTTLE_HOMEWARD="HOMEWARD",b.prototype["default"]={building1:"",building74:"",building61:"",building65:""},b.setTime=function(a,c){return new b(a===b.SHUTTLE_OUTWARD?{building1:c[0],building74:c[1],building61:c[2],building65:c[3]}:{building1:c[3],building74:c[2],building61:c[1],building65:c[0]})},b}(Backbone.Model),App.TimetableModel=a}.call(this),function(){var a,b,c,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.events={'change input[name="shuttle"]':"onChangeShuttle"},b.prototype.initialize=function(){this.initView()},b.prototype.render=function(){return this},b.prototype.onChangeShuttle=function(){var a;return a=this.$('input[name="shuttle"]:checked').val(),App.timetableList.shuttle=a,App.timetableList.reset(this.timetableArray[a]),this.render()},b.prototype.initView=function(){$.ajax({url:"/api/servicetable",cache:!1,dataType:"json"}).then(function(a){return function(b){return a.serviceDay=c(b),$.ajax({url:"/api/timetable",cache:!1,dataType:"json"})}}(this)).then(function(a){return function(b){return a.setTimetable(b)}}(this))},b.prototype.setTimetable=function(a){var b,c,d,e,f,g,h,i;for(this.timetableArray={outward:[],homeward:[]},h=a.timetableList,d=0,f=h.length;f>d;d++)if(c=h[d],c.serviceDay===this.serviceDay)for(i=c.busStopTimeList,e=0,g=i.length;g>e;e++)b=i[e],this.timetableArray[c.shuttle.toLowerCase()].push(App.TimetableModel.setTime(c.shuttle,b))},b}(Backbone.View),b=function(a){var b,c,d;return d=a.getFullYear(),c=a.getMonth()+1,b=a.getDate(),c=10>c?"0"+c:c,b=10>b?"0"+b:b,""+d+"/"+c+"/"+b},c=function(a){var c,d;return c=new Date,d=a.serviceMap[b(c)],d?d:0===c.getDay()?"SUNDAY":6===c.getDay()?"SATURDAY":"WEEKDAY"},App.AppView=a}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.model=App.rideBusModel,b.prototype.events={"change #beforeAlert":"onChangeBeforeAlert"},b.prototype.initialize=function(){return b.departureTimeTmpl=_.template($("#departureTimeTmpl").html()),_.bindAll(this,"onChange"),this.model.on("change",this.onChange),this.$("#beforeAlert").val(this.model.get("beforeAlert")),this.render()},b.prototype.render=function(){return this.$("#departureTime").html(b.departureTimeTmpl(this.model.toJSON())),this},b.prototype.setTimer=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(c=this.model.get("departureTime"),""!==c&&(a=parseInt($("#beforeAlert").val(),10),!isNaN(a))){for(Notification.requestPermission(function(a){var b;return b=a}),b=new Date,e=b.getHours(),f=b.getMinutes(),g=b.getSeconds(),i=c.split(":"),d=k=0,l=i.length;l>k;d=++k)j=i[d],i[d]=parseInt(j,10);if(h=1e3*(60*(60*(i[0]-e)+i[1]-f-a)-g),!(0>=h))return this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){var a;return a=new Notification("バスが来ます",{tag:"tag",body:"通知の本文",icon:"icon.png"})},h)}},b.prototype.onChangeBeforeAlert=function(){return this.setTimer()},b.prototype.onChange=function(){return this.render(),this.setTimer()},b}(Backbone.View),App.RideBusView=a}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.events={"click tbody td":"onClickTime"},b.prototype.initialize=function(a){return b.timetableTmpl=_.template($("#timetableTmpl").html()),b.timetableHeaderOutwardTmpl=_.template($("#timetableHeaderOutwardTmpl").html()),b.timetableHeaderHomewardTmpl=_.template($("#timetableHeaderHomewardTmpl").html()),b.timetableRowOutwardTmpl=_.template($("#timetableRowOutwardTmpl").html()),b.timetableRowHomewardTmpl=_.template($("#timetableRowHomewardTmpl").html()),_.bindAll(this,"onReset"),this.collection=a.collection,this.collection.on("reset",this.onReset)},b.prototype.render=function(){var a,c;return this.$el.html(b.timetableTmpl()),c=this.$("thead"),a=this.$("tbody"),"outward"===this.collection.shuttle?(c.html(b.timetableHeaderOutwardTmpl()),this.collection.each(function(c){return a.append(b.timetableRowOutwardTmpl(c.toJSON()))})):(c.html(b.timetableHeaderHomewardTmpl()),this.collection.each(function(c){return a.append(b.timetableRowHomewardTmpl(c.toJSON()))})),this},b.prototype.onReset=function(){return this.render()},b.prototype.onClickTime=function(a){var b,c;return b=$(a.currentTarget),c=b.parent("tr").find("td").index(b),"outward"===this.collection.shuttle&&c>=1||"homeward"===this.collection.shuttle&&c>=3?void 0:App.rideBusModel.set("departureTime",b.text())},b}(Backbone.View),App.TimetableListView=a}.call(this),function(){var a,b;a=new App.AppView({el:"#main"}),b=new App.TimetableListView({el:"#timetable",collection:App.timetableList}),App.rideBusView=new App.RideBusView({el:"#rideBus"})}.call(this);
//# sourceMappingURL=../jssrc/kitbus.map